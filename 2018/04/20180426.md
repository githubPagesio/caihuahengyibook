# 20180426

# 2018年04月26日
**肖威工作总结**
- 上午：整理思维体系大纲，明确发展的方向
- 下午：添加 区块链 500 强媒体，查看 dapp 的开发的过程；
Dapp-Development-Guide
https://github.com/ywzqhl/Dapp-Development-Guide

以太坊开发DApp实战教程——用区块链、星际文件系统（IPFS）、Node.js和MongoDB来构建电商平台
https://github.com/jimilai/ethereum-dapp-ipfs-node.js-mongodb

以太坊DAPP开发入门教程，涵盖以太坊去中心化应用相关基础内容：区块链，智能合约，松露框架，甘纳许仿真器，密实度语言，SOLC编译器，web3js库，通证（代币）发行等，手把手地教大家构建一个区块链投票系统。
https://github.com/jimilai/ethereum

maheshmurthy / ethereum_voting_dapp
https://github.com/maheshmurthy/ethereum_voting_dapp

你好，编写以太坊应用程序的世界！
11 9 joshpierro / ethereum-voting-dapp
https://github.com/joshpierro/ethereum-voting-dapp

区块链白皮书、书籍、交易所、币种、自媒体等资源汇总
https://github.com/dily3825002/awesome-blockchain

部署Ethereum Dapps指南
https://github.com/hitchcott/dapps-101

105学年度国立政治大学资讯科​​学系软体工程DApp范例
https://github.com/noeleon930/nccucs-se2016-dapp-example

简单的投票
https://github.com/julianduque/simple-vote

掌握以太坊，Andreas M. Antonopoulos，Gavin Wood
https://ethereumbook.info/
https://github.com/ethereumbook/ethereumbook

简单的投票dapp教程
User1m / votingdapptut
https://github.com/User1m/votingdapptut

100 Days of Dapps
https://agermanidis.github.io/100daysofdapps/#/

- 晚上：继续查看 dapp 的开发的逻辑；
薄雾 - 薄雾。浏览和使用以太坊网络上的应用程序。
https://www.findbestopensource.com/tagged/web3

https://www.findbestopensource.com/article





以太坊开发者研讨会
https://www.garysguide.com/events/u10115q/Ethereum-Developer-Workshop-For-Beginners



开始使用这个动手练习研讨会为以太坊区块链编程智能合约在



过去的18个月里，区块链和数字货币的主题已经爆炸。作为证明，2017年7月cyrptocurrency的总市值超过1000亿美元。随着全球企业从沃尔玛到JP Morgan，IBM，Microsoftand等越来越多的有经验的程序员对这些资深和新铸造企业的需求越来越多，正在以不可磨灭的速度增长。
有经验的区块链开发人员需要大量薪水
哪些类型的开发人员职位在那里？看看这个Coindeskarticle。

在本课程中，您将学习如何使用编程语言进行编码.Solidity.Solidity是开发人员称为TheEthereum区块链的最流行的分布式计算平台上最流行的编程语言。以太坊的独特之处在于，它允许完整的程序驻留在区块链上并运行。这些程序通常被称为精明合同，并且通常是Dapps或分布式应用程序的一部分。
想要进入以太坊编码，但不知道从哪里开始？了解什么是智能合约，编程语言Solidity，然后编写并部署您的第一份智能合约。

两小时的研讨会。编程将在基于Web的IDE上进行，Remix。

议程：


介绍以太坊和智能合约


智能合约用例的交互式演示[Etherisc Insurance Dapp]


安装和设置Metamask


Remix IDE概述 Solidity


语法，关键字和表达式简介 Solidity


功能：修饰符，回退函数，事件


编写彩票智能合同


部署和与智能交互合同



讲师：Solomon Lederer博士，获得分布式和特设传感器网络的博士学位，在那里他提出了网络自组织的新方法。他继续将他的研究应用于为美国空军开发新的无线网络。他一直在教区块链和以太坊两年。

先决条件：以前的编程经验是必需的。Javascript的一些熟悉是理想的，但其他编程经验也足够了。

要求：笔记本电脑，Chrome浏览器（能够安装插件）。

过去的毕业生表示：
“配备了非常有帮助和友好的主题专家。”
“ - 布鲁克阿姆斯特朗，Blockskye首席执行官

”真棒!!非常吸引人的互动课程，培训师非常有帮助，学到了很多，很棒的材料。“
- Arpita Bhatia

”大学永远无法提供的东西。“ 
- Swifto

座席的软件开发人员Alan Wang 有限。今天注册



客户包括财富500强管理人员，学术界成员，政府官员，技术人员和业余爱好者。如果您或贵公司有任何疑问或有兴趣接收私人或个性化咨询，请发送电子邮件至infoinfo@blockmatics.tech。








Loom僵尸大军、Hackers午后读物，只用48小时DApp你也能写

本文于4月13日最早发布于微信公众号：DappReview，如需转载请提前联系取得同意

最好用的Dapp应用排行已上线，https://dapp.review



最近有些小伙伴私信问米芽，怎么上手以太坊DApp的开发，去哪里找资料，DappReview会不会写教程诸如此类的问题。

于是有了这一篇极简的以太坊DApp开发指南。注意，是指南，而非教程。米芽回顾了一下自己从去年底开始写智能合约到现在写DApp的整个过程，资料和教程倒是看了不少，但真正有用的并不多，反而踩了不少坑。因此效率最优的学习方式并不是看尽可能多的资料教程，而在于找到正确的引导，按照正确的顺序把知识点连成线。



这篇指南的意义在于，让你在48小时内可以从头到尾了解Solidity编程、DApp的开发并能实际落地完成。


在目前以太坊的生态下，做一个简单的web端DApp所需掌握的三个技能点



前端开发 - HTML/JavaScript/JQuery/各种前端框架
智能合约 - Solidity编程
前端与智能合约交互 - web3.js / Metamask / Infura


这里面前端开发本质上与区块链没有关联性，所需要的技能跟开发一个“古典”互联网web端所需的能力无区别，我们就不做赘述了。对于另外两部分，米芽只推荐两份教程（全部免费）。



1. CryptoZombies
https://cryptozombies.io/


CryptoZombies是由Loom Network开发的一个在线互动编程教程，它通过教你编写你自己的加密收藏品游戏，来学习用 Solidity 编写智能合约和DApp开发。



这是米芽认为到目前为止，最实用最细致的Solidity和DApp开发入门课程，没有之一，完爆各类线上线下付费培训。现在课程一共出了6课，每一课分为若干个小章节。


第1课内容

Solidity基础 - 变量、数学运算、数据结构、函数及函数属性等

第2课内容

Solidity进阶 - 地址、Mapping、继承、Storage vs Memory、接口等

第3课内容

Solidity高阶 - 合约所有权、Gas花费、函数修饰符、代码优化、代码安全等

第4课内容

支付函数、提现函数、随机数、僵尸作战实例（对战、输赢）

第5课内容

ERC 20 代币、ERC 721 代币标准、加密资产交易、防止溢出等

第6课内容

前端与智能合约交互 - Web3.js、Metamask、Infura、事件监听等


教程结束后获得的僵尸大军

除了智能合约的部署之外，CryptoZombies已经将大部分内容深入浅出的全部覆盖。



据独家消息了解，CryptoZombies的学员数量目前已经突破20万，应该是受众面最广的以太坊培训类教程。

优点：内容详细，深入浅出、有互动性和趣味性。

美中不足：没有带用户在真实的开发环境中走一遍开发流程和部署上线。



而这一点不足就由下面这一套教程来补充。



2. Ethereum Development Walkthrough

该系列是由开发者dev_zl发表在Hackernoon上的一个系列文章 —— 以太坊开发攻略。是米芽读过的为数不多思路清晰、行文简洁、干货满满的博文类教程。这个系列的特点是，带着读者手把手，一步一步地走一遍开发实例，全部读完后，读者是可以独立的在本地上线一个DApp。

Part 1: Smart contracts

第一部分——智能合约

https://hackernoon.com/ethereum-development-walkthrough-part-1-smart-contracts-b3979e6e573e



Part 2: Truffle, Ganache, Geth and Mist

第二部分——各类开发工具

https://hackernoon.com/ethereum-development-walkthrough-part-2-truffle-ganache-geth-and-mist-8d6320e12269



Part 3: Security, limitations, and considerations

第三部分——安全性、限制、顾虑

https://hackernoon.com/ethereum-development-walkthrough-part-3-security-limitations-and-considerations-d482f05278b4



Part 4: Tokens and ERCs

第四部分——代币标准

https://hackernoon.com/ethereum-development-walkthrough-part-4-tokens-and-ercs-68645cf2f73e



Part 5: Making a DApp

第五部分——DApp开发

https://hackernoon.com/ethereum-development-walkthrough-part-5-making-a-dapp-4c2a3bbcd5e5

该系列文章为英文，可能需要科学上网。

注：Hackernoon这个网站是米芽每天必看的网站之一，其Slogan是how hackers start their afternoons.



以上两份教程对于有一定编程基础的小伙伴来说，两整天的时间绝对可以轻轻松松完成。只需要48小时之内，DApp新世界的大门就为你打开了。



下一步如何快速进阶？
1. 阅读已有DApp的智能合约

哪里找？DappReview（https://dapp.review）的网站上有每一个DApp的合约地址，点开直接转跳到etherscan查看合约源代码。（见下图）

注：点击“阅读原文”直接访问DappReview


2. 查阅各个开发工具的官方文档



以太坊wiki

https://github.com/ethereum/wiki/wiki

Solidity

https://solidity.readthedocs.io/

Metamask

https://github.com/MetaMask/faq/

Infura

https://infura.io/

Truffle

http://truffleframework.com/

其余工具官方文档请自行google



3. 做以下操作

有问题就Google
技术问题上Stackoverflow
多读Medium、Hackernoon
多逛逛各个开发工具的社区
关注DappReview（笑~~）


彩蛋福利
在北京时间4月20日前完成CryptoZombies教程中6节课的全部内容，将会得到Loom的以下奖励：


如果你不明白这4项奖励代表什么，请阅读Loom系列文章：

- 区块链游戏生态抢滩登陆战，谁能拔得头筹？

- 最快落地的区块链游戏生态——Loom侧链



希望读完这篇文章后，你的这个周末可以从“看动漫+打游戏+睡懒觉的两天”变成48小时的DApp Hackathon。在开脑洞的过程中，如果想到有意思的DApp点子欢迎“勾搭”。



可能是最好用的DApp导航

https://dapp.review

点击“阅读原文"访问



关注米芽DappReview，你能获得什么？



各类Dapp评测

最新最快的Dapp指南，最前沿的底层生态解析

游戏Dapp开发方向和真知灼见

汇集了米芽从小到大近3000游戏涉猎的结晶

智能合约里面的坑

哪些游戏的合约有漏洞？可以作弊？

粉丝 ETH 抽奖计划

免费送钱你要不要？

群内分享
1.如何实现“互联网规模”共识？
2.刘瑾：区块链技术对货币体系及政策的影响分析 | 央行与货币
3.区块链行业研究报告第一期：物联网
4. 干货 | 智能合约开发简介
5.HiBlock社区-Bob带你玩转宠物店-开发实战|3步教你在以太坊上开一家宠物店
6.HiBlock社区-淘飞翔-hyperledger开发分享——一线开发者在超级账本项目开发实践
7.社区成员王登辉分享-技术小白如何开发一个DAPP区块链应用(以宠物商店为例)

技术小白如何开发一个DAPP区块链应用(以宠物商店为例)
作者-磨链社区-王登辉

原文链接：技术小白如何开发一个DAPP区块链应用(以宠物商店为例)

文章摘要
【本文目标】
通过逐步的指导和截图举证，一步步带领一个技术小白完成一个宠物商店DAPP应用的开发和部署。
【环境前置条件】
参考《第一课 如何在WINDOWS环境下搭建以太坊开发环境》https://www.jianshu.com/p/683ea7d62a39，已完成Ubuntu的安装，已完成TRUFFLE，Ganache-cli，lite-server的安装；
本案例是通过WINDOWS的XSHELL客户端同本机的Ubuntu命令操作进行的。
已在本地WIDOWS环境完成MetaMask轻钱包客户端的安装。
最好遵循从头开始的课程学习顺序。不过如果你想半途插入实操学习，问题也不大，遇到障碍时反向找对应文章的指导内容即可完成。
【技术收获】
从本实践中，你可以学习到：
搭建智能合约开发环境
创建Truffle项目
编写智能合约
编译和部署智能合约到区块链
如何通过Web3和智能合约交互
MetaMask 的使用
【实操课程列表】
第一课 如何在WINDOWS环境下搭建以太坊开发环境
第二课 如何实现以太坊最简智能合约“Hello World”的运行
第四课 以太坊开发框架Truffle从入门到实战
（未列出的课程为知识普及的非实操类课程，所有区块链文章参考“区块链入口https://www.jianshu.com/c/93efec13d95f”专栏）
下载/编写TRUFFLE框架的智能合约
项目背景
Pete有一个宠物店，有16只宠物狗，他想开发一个去中心化应用，让大家来领养宠物。在truffle box中，已经提供了pet-shop的网站部分的代码，我们只需要编写合约及交互部分。
【官网原始参考】
代码框架下载：http://truffleframework.com/boxes/pet-shop
开发指导：http://truffleframework.com/tutorials/pet-shop
环境搭建
环境需要NodeJS, Truffle，Ganache-Cli, Lite-Server, Meta-Mask等程序，按照步骤可以参考《第一课 如何在WINDOWS环境下搭建以太坊开发环境》 搜索对应关键字在已安装的UBUNTU操作系统完成安装。
安装Node:

sudo apt-get install curl
curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash
sudo apt-get install -y nodejs


安装 Truffle ：

npm install -g truffle


安装Ganache

sudo npm install -g ganache-cli


【说明】Ganache（或Ganache CLI）已经取代了 testrpc。

4.Lite-Server, Meta-Mask安装
本文后面章节描述。

创建项目
建立项目目录并进入

mkdir dapp-guide-pet-shop
cd dapp-guide-pet-shop


使用truffle unbox 创建项目
下载官方程序代码

truffle unbox pet-shop


输出成功结果：

Downloading...
Unpacking...
Setting up...
Unbox successful. Sweet!
Commands:
Compile:        truffle compile
Migrate:        truffle migrate
Test contracts: truffle test
Run dev server: npm run dev


项目目录结构
contracts/ 智能合约的文件夹，所有的智能合约文件都放置在这里，里面包含一个重要的合约Migrations.sol（稍后再讲）
migrations/ 用来处理部署（迁移）智能合约 ，迁移是一个额外特别的合约用来保存合约的变化。
test/ 智能合约测试用例文件夹
truffle.js/ 配置文件
其他代码可以暂时不用管
【说明】如果想了解TRUFFLE框架更详细的内容，可参考文章《第四课 以太坊开发框架Truffle从入门到实战》

编写智能合约
智能合约承担着分布式应用的后台逻辑和存储。智能合约使用solidity编写。
在contracts目录下，添加合约文件Adoption.sol

pragma solidity ^0.4.17;
contract Adoption {
 address[16] public adopters; // 保存领养者的地址
// 领养宠物
function adopt(uint petId) public returns (uint) {
require(petId >= 0 && petId <= 15); // 确保id在数组长度内
   adopters[petId] = msg.sender; // 保存调用这地址
return petId;
}
// 返回领养者
function getAdopters() public view returns (address[16]) {
return adopters;
}
}


编译部署智能合约

Truffle集成了一个开发者控制台，可用来生成一个开发链用来测试和部署智能合约。
编译
Solidity是编译型语言，需要把可读的Solidity代码编译为EVM字节码才能运行。
进入dapp的根目录dapp-guide-pet-shop执行命令，

> truffle compile
输出
Compiling ./contracts/Adoption.sol...
Writing artifacts to ./build/contracts


编写部署代码

编译之后，就可以部署到区块链上。
在migrations文件夹下已经有一个1_initial_migration.js部署脚本，用来部署Migrations.sol合约。
Migrations.sol 用来确保不会部署相同的合约。

现在我们来创建一个自己的部署脚本2_deploy_contracts.js

var Adoption = artifacts.require("Adoption");
module.exports = function(deployer) {
 deployer.deploy(Adoption);
};


安装启动Ganache测试环境
在执行部署之前，需要确保有一个区块链运行, 可以使用
Ganache来开启一个私链来进行开发测试。
参考文章《第一课 如何在WINDOWS环境下搭建以太坊开发环境》 对应的章节，完成ganache-cli的安装。

sudo npm install -g ganache-cli


在新的命令行窗口运行ganache-cli程序：

cd /usr/work/Ganache
ganache-cli >> trace.log


这个>>目的是把ganache-cli的结果输出到文件，便于后面复制钱包地址用于查看ETH余额。作者实践时把这2行命令合并成一行执行。

ganache-cli >> /usr/work/Ganache/trace.log


这个命令窗口用于运行Ganache程序输出，不可关闭。需要新开一个命令窗口用于执行TRUFFLE的命令。






打开trace.log文件，可查看默认启动的10个钱包账户和对应的私钥地址：

Available Accounts
==================
(0) 0x7554cc8c721712adde43e67a5669225bbe8f21f6
(1) 0x3e6ce6a43c1fa565b5b90963bef090625d3edc6c
(2) 0xeb2eb6ed4b325e77f5a597497ec5ffaa2f5c2650
(3) 0x1de061d5f225533f7e3c38a5905a6ca2ecb3e55a
(4) 0x3ec2e1ed3f47fc7ab9cca1fe09afe9fd1feb789b
(5) 0xf27a303880b73a0a287a2e5dc1286098fb49ed63
(6) 0xf3c007932e1de894503166aee3cbf85b4aff0188
(7) 0xe7655733659c14c7c83fb71bd40dc51796592d96
(8) 0x507722000223ca96ac646198709b9ae3f7f49a5a
(9) 0x82b087a83f72cc7dd5ca6ac7787a366b2c3ff143


Private Keys
==================
(0) 629551aa45c594ce822c5b4a378d01cf46fb57c15b69a61eb400a4867ffab002
(1) a90103a95ed805acc52782eaa29eb061f6c2a9431fed3ac18a683ea3143a29b6
(2) c2b13ce370fb235997dc4783ce591a22e5b3909e934dc7c0f61797ce57d5059d
(3) 841d0e1d3dc658ad2f308c7292b4d5c40da158d170cf3ed9001c64b8352cd0c2
(4) 255225aedba340b6ec62e6c86a6202535d7382704b129d022461c69b8341d2dd
(5) c3fd784fc7a46edb5e7cba9e90120e51152a3fbe2d8b97a0c3106791d3bbe87e
(6) f8f90b056c419464d48dcd12ac8e326a31ebe300ea5e245876fe0308c511fbac
(7) 09e20553971b044c1fda8ac88f2ed1dcdff6af0889fc05c2ad4374c52d4f52d7
(8) 142643d0fb6f4a78e0fd291a568b784869927d8f8eee87bf3fbdbf493ec3f425
(9) 8f89d4a05582193cc32f800ecf9419f35b5384abc5db42afd4ec016a54d27716


配置以太坊客户端本地环境
ruffle.js是truffle的配置文件,位于dapp-guide-pet-shop目录下，启动好以太坊本地结点以后，我们需要让truffle去识别它并使用它，这就需要在truffle.js中配置相关属性：

module.exports = {
// See <http://truffleframework.com/docs/advanced/configuration>
// for more about customizing your Truffle configuration!
 networks: {
   development: {
     host: "127.0.0.1",
     port: 8545,
     network_id: "*" // Match any network id
}
}
};


执行部署命令

接下来在新的命令窗口执行部署命令

cd /usr/work/dapp-guide-pet-shop
   truffle migrate


执行后，有一下类似的输出，

Using network 'development'.
Running migration: 1_initial_migration.js
Deploying Migrations...
... 0x29612ceea67bc946cc6ae82afbedc546f9a53ba8cab5d804f9025fb8f15e48f8
Migrations: 0x8af912046664ba26738b811c34068d42216528c0
Saving successful migration to network...
... 0x6c968a3c492439ab22028e1956360a6b73a02716c436b15234cd29804dac7298
Saving artifacts...
Running migration: 2_deploy_contracts.js
Deploying Adoption...
... 0x27448e4f75b608015f3670e3650cf607c882fe7f1a32f98e8a94bf7a406c871c
Adoption: 0xe42f434105a7e0eacf4f4229c76e1e135d536db6
Saving successful migration to network...
... 0x9375cd6fa143d01a520c5ed0d46cfe859f482b01e37cf678d751c5db6a278e5f
Saving artifacts...


查看Ganache-cli的输出文件：trace.log,可以看到区块链状态的变化，现在产生了4个区块。

net_version
eth_accounts
eth_accounts
net_version
net_version
eth_sendTransaction
Transaction: 0x29612ceea67bc946cc6ae82afbedc546f9a53ba8cab5d804f9025fb8f15e48f8
Contract created: 0x8af912046664ba26738b811c34068d42216528c0
Gas usage: 268407
Block Number: 1
Block Time: Tue Apr 10 2018 09:10:18 GMT+0800 (CST)
eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction
Transaction: 0x6c968a3c492439ab22028e1956360a6b73a02716c436b15234cd29804dac7298
Gas usage: 41981
Block Number: 2
Block Time: Tue Apr 10 2018 09:10:19 GMT+0800 (CST)
eth_getTransactionReceipt
eth_accounts
net_version
net_version
eth_sendTransaction
Transaction: 0x27448e4f75b608015f3670e3650cf607c882fe7f1a32f98e8a94bf7a406c871c
Contract created: 0xe42f434105a7e0eacf4f4229c76e1e135d536db6
Gas usage: 247573
Block Number: 3
Block Time: Tue Apr 10 2018 09:10:19 GMT+0800 (CST)
eth_newBlockFilter
eth_getFilterChanges
eth_getTransactionReceipt
eth_getCode
eth_uninstallFilter
eth_sendTransaction
Transaction: 0x9375cd6fa143d01a520c5ed0d46cfe859f482b01e37cf678d751c5db6a278e5f
Gas usage: 26981
Block Number: 4
Block Time: Tue Apr 10 2018 09:10:20 GMT+0800 (CST)
eth_getTransactionReceipt


这时说明已经智能合约已经部署好了。

测试

现在我们来测试一下智能合约，测试用例可以用 JavaScript or Solidity来编写，这里使用Solidity。

在test目录下新建一个TestAdoption.sol，编写测试合约

pragma solidity ^0.4.17;
import "truffle/Assert.sol"; // 引入的断言
import "truffle/DeployedAddresses.sol"; // 用来获取被测试合约的地址
import "../contracts/Adoption.sol"; // 被测试合约
contract TestAdoption {
Adoption adoption = Adoption(DeployedAddresses.Adoption());
// 领养测试用例
function testUserCanAdoptPet() public {
uint returnedId = adoption.adopt(8);
uint expected = 8;
Assert.equal(returnedId, expected, "Adoption of pet ID 8 should be recorded.");
}
// 宠物所有者测试用例
function testGetAdopterAddressByPetId() public {
// 期望领养者的地址就是本合约地址，因为交易是由测试合约发起交易，
   address expected = this;
   address adopter = adoption.adopters(8);
Assert.equal(adopter, expected, "Owner of pet ID 8 should be recorded.");
}
// 测试所有领养者
function testGetAdopterAddressByPetIdInArray() public {
// 领养者的地址就是本合约地址
   address expected = this;
   address[16] memory adopters = adoption.getAdopters();
Assert.equal(adopters[8], expected, "Owner of pet ID 8 should be recorded.");
}
}
Assert.sol 及 DeployedAddresses.sol是Truffle框架提供，在test目录下并不提供truffle目录。
TestAdoption合约中添加adopt的测试用例
运行测试用例
在终端中，执行
truffle test
如果测试通过，则终端输出：
Using network 'development'.
Compiling ./contracts/Adoption.sol...
Compiling ./test/TestAdoption.sol...
Compiling truffle/Assert.sol...
Compiling truffle/DeployedAddresses.sol...
Compilation warnings encountered:
truffle/Assert.sol:1563:9: Warning: Use of the "var" keyword is deprecated.
var nstr = _itoa(value, 10);
^------^
,truffle/Assert.sol:1580:9: Warning: Use of the "var" keyword is deprecated.
var nstr = _utoa(value, 10);
^------^
,truffle/Assert.sol:1597:9: Warning: Use of the "var" keyword is deprecated.
var nstr = _ltoa(value);
^------^
,truffle/Assert.sol:1347:13: Warning: Invoking events without "emit" prefix is deprecated.
TestEvent(true, "");
^-----------------^
,truffle/Assert.sol:1349:13: Warning: Invoking events without "emit" prefix is deprecated.
TestEvent(false, message);
^-----------------------^
TestAdoption
✓ testUserCanAdoptPet (246ms)
✓ testGetAdopterAddressByPetId (231ms)
✓ testGetAdopterAddressByPetIdInArray (287ms)
3 passing (2s)


创建用户接口和智能合约交互

我们已经编写和部署及测试好了我们的合约，接下我们为合约编写UI，让合约真正可以用起来。

在Truffle Box pet-shop里，已经包含了应用的前端代码，代码在src/文件夹下。

在编辑器中打开src/js/app.js
可以看到用来管理整个应用的App对象，init函数加载宠物信息，就初始化web3.
web3是一个实现了与以太坊节点通信的库，我们利用web3来和合约进行交互。
初始化web3

接下来，我们来编辑app.js修改initWeb3():
删除注释，修改为：

 initWeb3: function() {
// Is there an injected web3 instance?
if (typeof web3 !== 'undefined') {
App.web3Provider = web3.currentProvider;
} else {
// If no injected web3 instance is detected, fall back to Ganache
App.web3Provider = new Web3.providers.HttpProvider('http://localhost:8545');
}
   web3 = new Web3(App.web3Provider);
return App.initContract();
}


代码中优先使用 MetaMask提供的web3实例，如果没有则从本地环境创建一个。
实例化合约

使用truffle-contract会帮我们保存合约部署的信息，就不需要我们手动修改合约地址，修改initContract()代码如下：

initContract: function() {
// 加载Adoption.json，保存了Adoption的ABI（接口说明）信息及部署后的网络(地址)信息，它在编译合约的时候生成ABI，在部署的时候追加网络信息
   $.getJSON('Adoption.json', function(data) {
// Get the necessary contract artifact file and instantiate it with truffle-contract
// 用Adoption.json数据创建一个可交互的TruffleContract合约实例。
var AdoptionArtifact = data;
App.contracts.Adoption = TruffleContract(AdoptionArtifact);
// Set the provider for our contract
App.contracts.Adoption.setProvider(App.web3Provider);
// Use our contract to retrieve and mark the adopted pets
return App.markAdopted();
});
return App.bindEvents();
},


处理领养

修改markAdopted()代码：

markAdopted: function(adopters, account) {
var adoptionInstance;
App.contracts.Adoption.deployed().then(function(instance) {
     adoptionInstance = instance;
// 调用合约的getAdopters(), 用call读取信息不用消耗gas
return adoptionInstance.getAdopters.call();
}).then(function(adopters) {
for (i = 0; i < adopters.length; i++) {
if (adopters[i] !== '0x0000000000000000000000000000000000000000') {
         $('.panel-pet').eq(i).find('button').text('Success').attr('disabled', true);
}
}
}).catch(function(err) {
     console.log(err.message);
});
}


修改handleAdopt()代码：

handleAdopt: function(event) {
event.preventDefault();
var petId = parseInt($(event.target).data('id'));
var adoptionInstance;
// 获取用户账号
   web3.eth.getAccounts(function(error, accounts) {
if (error) {
       console.log(error);
}
var account = accounts[0];
App.contracts.Adoption.deployed().then(function(instance) {
       adoptionInstance = instance;
// 发送交易领养宠物
return adoptionInstance.adopt(petId, {from: account});
}).then(function(result) {
return App.markAdopted();
}).catch(function(err) {
       console.log(err.message);
});
});
}


安装和配置lite-server

【定义】lite-server
 是一个全功能的网站架设工具软件包轻量级的，仅适用于开发 的 node 服务器， 它仅支持 web app。 它能够为你打开浏览器,
当你的html或是JavaScript文件变化时，它会识别到并自动帮你刷新浏览器, 还能使用套接字自动注入变化的CSS,
当路由没有被找到时，它将自动后退页面。
参考文章《第一课 如何在WINDOWS环境下搭建以太坊开发环境》的"（8）安装 lite-server 【可选】”章节完成lite-server的安装。https://www.jianshu.com/p/683ea7d62a39

bs-config.json文件指示了lite-server的工作目录。
{
"server": {
"baseDir": ["./src", "./build/contracts"]
}
}


./src 是网站文件目录
./build/contracts 是合约输出目录

以此同时，在package.json文件的scripts中添加了dev命令：

{
"name": "pet-shop",
"version": "1.0.0",
"description": "",
"main": "truffle.js",
"directories": {
"test": "test"
},
"scripts": {
"dev": "lite-server",
"test": "echo \"Error: no test specified\" && exit 1"
},
"author": "",
"license": "ISC",
"devDependencies": {
"lite-server": "^2.3.0"
}
}


当在新的命令窗口运行npm run dev的时候，就会启动lite-server

cd /usr/work/dapp-guide-pet-shop
   npm run dev


正常的运行结果有如下类似输出内容：

> pet-shop@1.0.0 dev /usr/work/dapp-guide-pet-shop
> lite-server
** browser-sync config **
{ injectChanges: false,
 files: [ './**/*.{html,htm,css,js}' ],
 watchOptions: { ignored: 'node_modules' },
 server:
{ baseDir: [ './src', './build/contracts' ],
    middleware: [ [Function], [Function] ] } }
[Browsersync] Access URLs:
---------------------------------------
Local: http://localhost:3000
External: http://192.168.80.144:3000
---------------------------------------
         UI: http://localhost:3001
UI External: http://192.168.80.144:3001
---------------------------------------
[Browsersync] Serving files from: ./src
[Browsersync] Serving files from: ./build/contracts
[Browsersync] Watching files...
安装 MetaMask和配置区块链网络
安装 MetaMask

【定义】MetaMask 是一款插件形式的以太坊轻客户端，开发过程中使用MetaMask和我们的dapp进行交互是个很好的选择。
作者是在本地WINDOWS的CHROME浏览器上安装MetaMask钱包工具，具体的安装方法参考文章《第一课 如何在WINDOWS环境下搭建以太坊开发环境》的“（7）安装 MetaMask 【可选】”章节。
说明下，最详细的MetaMask安装/配置文章可参考欧阳哥哥的《以太坊钱包MetaMask使用教程》
配置钱包
1. 接受隐私条款
点击浏览器地址栏右侧，MetaMask的狐狸头图标，第一次使用时，会出一个隐私提示，如下图：






2. 接受服务条款  点击Accept按钮，显示的是MetaMask的服务条款，如下图2-2：






Accept按钮默认是灰色的，将滚动条拉到底部，就可以点击Accept按钮了。  3、创建新账号  创建新账号：输入一串8位以上的密码，再次重复输入，点击CREATE按钮，即可完成。  下面以创建新账号为例：






在点击CREATE按钮后，MetaMask会为用户创建12个英文助记词，一定要保存好这些助记词，点击SAVE SEED WORDS AS FILE可以将助词词以文件的形式保存到本地，建议使用纸笔手工记录并收藏于安全的地方。






连接开发区块链网络

默认连接的是以太坊主网（左上角显示），选择Custom RPC，添加Ubuntu的IP地址作为客户自定义RPC网络

http://192.168.80.144:8545
链接测试机以太坊客户端成功，菜单有链接成功的橙色√提示。






这是左上角显示为Private Network，此时显示的是默认的Account 1空账号，ETH数量为0。

导入Ganache-cli的第一个钱包账号

查看“trace.log”文件，可以Ganache-cli的第一个默认钱包地址为

(0) 629551aa45c594ce822c5b4a378d01cf46fb57c15b69a61eb400a4867ffab002
(1) a90103a95ed805acc52782eaa29eb061f6c2a9431fed3ac18a683ea3143a29b6


选择MetaMask的“Import Account”输入私钥，获取账号，可以查看对应ETH余额。






第一个钱包账户的余额：   


第二个钱包账户的余额：






至此MetaMask的安装，配置已经完成。  领养宠物

修改.\dapp-guide-pet-shop\src\index.html文件引用jquery的地址

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!--
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    -->
<script src="http://libs.baidu.com/jquery/1.9.0/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->


在WINDOWS浏览器输入测试网站地址  http://192.168.80.144:3000/
可以看到宠物商店的入口界面：






点击“Adopt”按钮，领养这个最漂亮的狗狗宝贝。MetaMask会提示我们交易的确认，如图：






点击“SUBMIT”按钮成功后，这个狗狗的按钮变为"SUCCESS"，该狗狗已被包养了。   


查看当前打开的账号ACCOUNT6，发现金额不再是100ETH，而是99.999ETH了。   


恭喜你，开发并成功部署了一个DAPP区块链应用程序，并且领养了几只小狗狗。  参考  本文是文章：一步步教你开发、部署第一个Dapp应用:宠物商店的实践课程，并根据作者环境做适当的修改截图。感谢分享指导。  如有问题，可简书私信联系辉哥。

磨链（mochain）计划各学习小组动态

磨链计划相关
磨链（mochain）学习小组清单

PS：想加入学习小组，请加磨链组织者微信(jackyjin09)。欢迎每一位区块链技术爱好者加入磨链，一块琢磨区块链技术



关于磨链和相关合作
磨链”---取磨炼之意，旨在普及区块链技术，磨炼技术，更好投身区块链行业。有兴趣一块琢磨区块链技术，联系笔者微信(jackyjin09)。  磨链社区是一个纯粹的技术社区，欢迎相关技术合作，在不违反原则的前提下，积极参与合作。
你可以在这里找到我们：
磨链社区公众号：   磨链mochain社区

1. 磨链社区：http://mochain.info
2. Github : https://github.com/mochain
3. Gitter 聊天: https://gitter.im/mochain
4. 知识星球: https://t.zsxq.com/M3BMVZN
5. 知乎：https://www.zhihu.com/people/mochain
